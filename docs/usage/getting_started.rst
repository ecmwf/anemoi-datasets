.. _usage-getting-started:

###########################
 Create Your First Dataset
###########################

The following example presents a simple but comprehensive recipe to
create an Anemoi dataset based on the atmospheric reanalysis ERA5. Once
built, the dataset can be used to train an ML atmospheric model, such as
AIFS, at low resolution. Note that a prebuilt version of the
anemoi-dataset generated by this recipe can be downloaded from this link
`era5-o48-2020-2021-6h-v1.zip
<https://data.ecmwf.int/anemoi-datasets/era5-o48-2020-2021-6h-v1.zip>`_.

.. warning::

   Please note that the size of the file
   ``era5-o48-2020-2021-6h-v1.zip`` is approximately 2.5 GB.

.. literalinclude:: yaml/aifs-ea-an-oper-0001-mars-o48-2020-2021-6h-v1.yaml
   :language: yaml

Let's break down the recipe to understand its main components! Some
concepts presented below will be explained in more detail in the USER
GUIDE section.

********************************
 Dataset Naming and Description
********************************

.. code:: yaml

   name: era5-o48-2020-2021-6h-v1

   description: Low-resolution reduced dataset for documentation purposes

   attribution: ECMWF/C3S

   licence: CC-BY-4.0

In the first lines of the recipe, we define the dataset name, a brief
description, the attribution to the data source, and the license under
which the dataset is released. This information will be stored in the
dataset metadata.

**Dates**

.. code:: yaml

   dates:
       start: '2020-01-01T00:00:00'
       end: '2021-12-31T23:00:00'
       frequency: 6h

Here, we define the time dimension of the Anemoi dataset. In particular,
we specify the start and end dates of the dataset and the frequency of
the time steps. In our specific example, the dataset is based on ERA5,
which has a 1-hour frequency, but we choose to downsample it to 6 hours
â€“ the typical timestep of the AIFS model. Note that this does not imply
that the timestep of the final model has to be 6 hours; it could be a
multiple of it.

*****************************************
 Getting the Data from Different Streams
*****************************************

In the remainder of the recipe (input), we join variables coming from
different streams to form the dataset. In particular, the following
streams are used:

-  **Surface fields** from the Copernicus Climate Data Store (CDS)
   through MARS requests.
-  **Pressure level fields** from the CDS through MARS requests.
-  **Accumulated fields** from the CDS through MARS requests.
-  **Computed constants** generated by Anemoi-datasets.

At this point, we also specify the resolution of the dataset, an *o48*
octahedral Gaussian grid in our specific case.

******************************
 How Do We Build the Dataset?
******************************

The dataset is built via the `anemoi-datasets` command-line tool as
follows:

.. code:: bash

   $ anemoi-datasets create era5-o48-2020-2021-6h-v1.yaml era5-o48-2020-2021-6h-v1.zarr

The YAML file ``era5-o48-2020-2021-6h-v1.yaml`` contains the recipe, and
the output is stored in ``era5-o48-2020-2021-6h-v1.zarr``.

.. warning::

   Note that running the recipe requires that the access to the CDS is
   correctly set up. For this, please refer to the :doc:`cds`.

Once the build is complete, you can inspect the dataset using the
following command:

.. code:: bash

   $ anemoi-datasets inspect aifs-ea-an-oper-0001-mars-o48-2020-2021-6h-v1.zarr
