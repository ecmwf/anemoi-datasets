{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "type": "object",
    "$id": "https://ecmwf.int/anemoi-datasets-recipe.schema.json",
    "title": "Product",
    "description": "Anemoi datasets recipe configuration",
    "additionalProperties": false,
    "$defs": {
        "source-or-filter": {
            "type": "object",
            "minProperties": 1,
            "maxProperties": 1
        },
        "pipe": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/input-object"
            }
        },
        "join": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/input-object"
            }
        },
        "concat": {
            "type": "array",
            "items": {
                "type": "object",
                "minProperties": 2,
                "maxProperties": 2,
                "required": [
                    "dates"
                ]
            }
        },
        "input-object": {
            "oneOf": [
                {
                    "$ref": "#/$defs/pipe"
                },
                {
                    "$ref": "#/$defs/join"
                },
                {
                    "$ref": "#/$defs/concat"
                },
                {
                    "$ref": "#/$defs/source-or-filter"
                }
            ]
        }
    },
    "properties": {
        "env": {
            "type": "object"
        },
        "description": {
            "type": "string"
        },
        "name": {
            "type": "string"
        },
        "licence": {
            "type": "string"
        },
        "attribution": {
            "type": "string"
        },
        "dates": {
            "type": "object",
            "required": [
                "start",
                "end"
            ],
            "properties": {
                "start": {
                    "type": "string",
                    "format": "date"
                },
                "end": {
                    "type": "string",
                    "format": "date"
                },
                "frequency": {
                    "type": [
                        "integer",
                        "string"
                    ]
                },
                "group_by": {
                    "type": [
                        "integer",
                        "string"
                    ]
                }
            }
        },
        "input": {
            "$ref": "#/$defs/input-object"
        },
        "data_sources": {
            "type": "object",
            "patternProperties": {
                "^[a-zA-Z_][a-zA-Z0-9_]*$": {
                    "$ref": "#/$defs/input-object"
                }
            },
            "additionalProperties": false
        },
        "output": {
            "type": "object"
        },
        "statistics": {
            "type": "object"
        },
        "build": {
            "type": "object"
        },
        "common": {
            "type": "object"
        },
        "platform": {
            "type": "object"
        }
    },
    "required": [
        "dates",
        "input"
    ]
}
